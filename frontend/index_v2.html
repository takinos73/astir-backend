<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASTIR CMMS â€“ Supervisor Dashboard</title>

  <link rel="stylesheet" href="style.css" />
</head>

<!-- =====================
     TASK VIEW MODAL
===================== -->
<div id="taskViewOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-box modal-wide">

    <h3>Task Details</h3>

    <!-- Dynamic content injected by JS -->
    <div id="taskViewContent"></div>

    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeTaskView()">Close</button>
    </div>

  </div>
</div>

  <!-- =====================
     HISTORY MODAL
===================== -->
<div id="historyOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-box modal-history">
    <h3>ğŸ“œ Task Execution History</h3>

    <div class="table-card" style="max-height:60vh; overflow:auto;">
      <table id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Asset</th>
            <th>Task</th>
            <th>Executed By</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" id="closeHistoryBtn">Close</button>
    </div>
  </div>
</div>

  <!-- Add Task Modal -->
<div id="addTaskOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-box modal-wide">
    <h3>New Non-Planned Task</h3>

    <input id="nt-line" placeholder="Line (L1â€¦)" />
    <input id="nt-machine" placeholder="Machine" />
    <input id="nt-section" placeholder="Section" />
    <input id="nt-unit" placeholder="Unit" />
    <input id="nt-task" placeholder="Task description" />
    <input id="nt-type" placeholder="Type (Breakdown / Repair)" />
    <input id="nt-due" type="date" />
    <textarea id="nt-notes" placeholder="Notes"></textarea>

    <div class="modal-actions">
      <button id="saveTaskBtn" class="btn-table">Save</button>
      <button id="cancelAddTask" class="btn-cancel">Cancel</button>
    </div>
  </div>
</div>
  
<body>

  <!-- Modal Î³Î¹Î± Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal-box">
      <h3>ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚</h3>
      <p>Î Î¿Î¹Î¿Ï‚ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï„Î·Î½ ÎµÏÎ³Î±ÏƒÎ¯Î±;</p>
      <input type="text" id="technicianInput" placeholder="ÎŒÎ½Î¿Î¼Î± Ï„ÎµÏ‡Î½Î¹ÎºÎ¿Ï" />
      <div class="modal-actions">
        <button id="confirmDone" class="btn-table">âœ” Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·</button>
        <button id="cancelDone" class="btn-cancel">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
      </div>
    </div>
  </div>

  <div class="app-shell">

  <!-- IMPORT PREVIEW MODAL -->
    
<div id="importPreviewOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-box modal-wide import-modal">

    <h3>Excel Import Preview</h3>
    <div id="importSummary" class="docs-subtitle"></div>

    <!-- SCROLLABLE BODY -->
    <div class="import-modal-body">
      <div class="table-card">
        <table id="importPreviewTable">
          <thead>
            <tr>
              <th>Excel Row</th>
              <th>Line</th>
              <th>Machine</th>
              <th>S.N</th>
              <th>Task</th>
              <th>Status</th>
              <th>Error</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- FIXED FOOTER -->
    <div class="import-modal-footer">
      <button id="confirmImportBtn" class="btn-table">âœ… Confirm Import</button>
      <button id="closeImportPreviewBtn" class="btn-cancel">Close</button>
    </div>

  </div>
</div>


    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-main">
        <div class="app-title">
          <span class="logo-dot"></span>
          ASTIR CMMS
        </div>
        <div class="app-subtitle">Maintenance â€“ Supervisor View</div>
      </div>
      <div class="app-header-meta">
        <div class="pill">
          Backend Live: PostgreSQL â€¢ Render
        </div>
        <span class="snapshot-note" id="snapshotStatus">
          No snapshot loaded
        </span>
      </div>
    <!-- =====================
     DEV LOGIN (ROLE SWITCH)
      ===================== -->
<div id="devLogin" style="display:flex; gap:8px; align-items:center;">
  <span style="opacity:0.7;">ğŸ‘¤ Role:</span>

  <select id="roleSelect">
    <option value="technician">Technician</option>
    <option value="planner">Planner</option>
    <option value="admin">Admin</option>
  </select>

  <button class="btn-secondary" id="loginAsRoleBtn">
    Login
  </button>
</div>

    </header>

    <!-- MAIN TABS -->
    <section class="main-tabs">
      <button class="main-tab" data-tab="assets">Assets</button>
      <button class="main-tab active" data-tab="tasks">Tasks</button>
      <button class="main-tab" data-tab="reports">Reports</button>
      <button class="main-tab" data-tab="docs">Documentation</button>
      
    </section>

    <!-- ===================== -->
    <!-- TAB: TASKS -->
    <!-- ===================== -->
    <div id="tab-tasks">

      <!-- KPIs -->
      <section class="kpi-strip">
        <article class="kpi-card">
          <span class="kpi-label">Total</span>
          <span id="kpiTotal" class="kpi-value">0</span>
        </article>
        <article class="kpi-card">
          <span class="kpi-label">Overdue</span>
          <span id="kpiOverdue" class="kpi-value">0</span>
        </article>
        <article class="kpi-card">
          <span class="kpi-label">Due â‰¤ 7 days</span>
          <span id="kpiSoon" class="kpi-value">0</span>
        </article>
        <article class="kpi-card">
          <span class="kpi-label">Completed</span>
          <span id="kpiDone" class="kpi-value">0</span>
        </article>
      </section>

      <!-- LINE TABS -->
  <!-- Line filters REMOVED (asset-based filtering only)   
      <section class="line-tabs-row">
        <div class="line-tabs">
          <button class="line-tab active" data-line="all">ALL</button>
          <button class="line-tab" data-line="L1">L1</button>
          <button class="line-tab" data-line="L2">L2</button>
          <button class="line-tab" data-line="L3">L3</button>
          <button class="line-tab" data-line="L4">L4</button>
          <button class="line-tab" data-line="L5">L5</button>
          <button class="line-tab" data-line="L6">L6</button>
          <button class="line-tab" data-line="L7">L7</button>
        </div>
      </section> -->
      

      <!-- FILTERS -->

<div class="controls-row">
  <button class="btn-secondary date-filter-btn active" data-filter="all">All</button>
  <button class="btn-secondary date-filter-btn" data-filter="today">Today</button>
  <button class="btn-secondary date-filter-btn" data-filter="week">This Week</button>
  <button class="btn-secondary date-filter-btn" data-filter="overdue">Overdue</button>

</div>      
      <section class="controls-row">
        <select id="machineFilter">
          <option value="all">All Machines</option>
        </select>  

        <label class="btn-secondary admin-only">
          ğŸ“‚ Upload Excel
          <input type="file" id="excelFile" accept=".xlsx,.xls" hidden />
        </label>

        <button class="btn-secondary admin-only" id="importExcelBtn">ğŸ“¥ Import Excel</button>

        <button class="btn-secondary admin-only" id="exportSnapshot">ğŸ“¦ Export Snapshot</button>
        <label class="btn-secondary admin-only">
          â™» Load Snapshot
          <input type="file" id="snapshotFile" accept="application/json" hidden />
        </label>
        <button class="btn-secondary admin-only" id="restoreSnapshot">Restore</button>
      </section>

      <button class="btn-secondary admin-only"" id="addTaskBtn">â• New Task</button>
      <button class="btn-secondary" id="openHistoryBtn">
        ğŸ“œ View History
      </button>

      <!-- TASK TABLE -->
      <div class="table-card">
        <table id="tasksTable">
          <thead>
            <tr>
              <th>Machine</th>
              <th>Section</th>
              <th>Unit</th>
              <th>Task</th>
              <th>Type</th>
              <th>Due Date</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- HISTORY -->
<section id="historySection" class="table-card" style="margin-top:30px;">
  <h3>ğŸ“œ Task History</h3>

  <table id="historyTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Asset</th>
        <th>Task</th>
        <th>Executed By</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

    
    <!-- ===================== -->
    <!-- TAB: DOCUMENTATION -->
    <!-- ===================== -->
    <div id="tab-docs" style="display: none;">

      <section class="docs-header">
        <h2>
          Documentation â€“ MasterPlan
          <span class="docs-hint">Î•Ï€Î¯ÏƒÎ·Î¼Î¿ MasterPlan PDF Ï„Î¿Ï… ÎµÏÎ³Î¿ÏƒÏ„Î±ÏƒÎ¯Î¿Ï…</span>
        </h2>
      </section>

      <section class="docs-controls">
        <label class="btn-secondary">
          ğŸ“¤ Upload MasterPlan PDF
          <input type="file" id="pdfInput" accept="application/pdf" hidden />
        </label>
        <button class="btn-secondary" id="openPdfBtn">ğŸ“„ Î ÏÎ¿Î²Î¿Î»Î® PDF</button>
      </section>

      <section class="docs-viewer-wrapper">
        <iframe
          id="pdfViewer"
          class="docs-viewer"
          src=""
          title="MasterPlan PDF"
        ></iframe>
      </section>

    </div>
<!-- TAB: ASSETS -->
<div id="tab-assets" style="display:none;">

  <section class="assets-header">
    <h2>Assets Management</h2>
    <p class="docs-subtitle">
      Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¼Î·Ï‡Î±Î½ÏÎ½ & Serial Numbers Î±Î½Î¬ Î³ÏÎ±Î¼Î¼Î®
    </p>
  </section>

  <section class="controls-row">
    <button class="btn-secondary" id="addAssetBtn">â• Add Asset</button>
  </section>

  <div class="table-card">
    <table id="assetsTable">
      <thead>
        <tr>
          <th>Line</th>
          <th>Machine</th>
          <th>Serial Number</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

    
    <!-- TAB: REPORTS -->
<div id="tab-reports" style="display: none;">
  <section class="reports-header">
    <h2>Reports</h2>
    <p class="reports-subtitle">
      Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î±Ï†Î¿ÏÏÎ½ ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·Ï‚ ÎºÎ±Î¹ export ÏƒÎµ PDF.
    </p>
  </section>

  <section class="reports-card">
    <div class="reports-grid">

      <!-- Report Type -->
      <div class="field">
        <label for="reportType">Report Type</label>
        <select id="reportType">
          <option value="status">Maintenance Status Report</option>
          <option value="overdue">Overdue Tasks Report</option>
          <option value="technician">Completed by Technician</option>
          <option value="nonplanned">Non-Planned Tasks Report</option>
        </select>
      </div>

      <!-- Date range -->
      <div class="field">
        <label for="dateFrom">From</label>
        <input id="dateFrom" type="date" />
      </div>

      <div class="field">
        <label for="dateTo">To</label>
        <input id="dateTo" type="date" />
      </div>

      <!-- Line -->
      <div class="field">
        <label for="reportLine">Line</label>
        <select id="reportLine">
          <option value="all">ALL</option>
          <option value="L1">L1</option>
          <option value="L2">L2</option>
          <option value="L3">L3</option>
          <option value="L4">L4</option>
          <option value="L5">L5</option>
          <option value="L6">L6</option>
          <option value="L7">L7</option>
        </select>
      </div>

      <!-- Status -->
      <div class="field">
        <label for="reportStatus">Status</label>
        <select id="reportStatus">
          <option value="all">ALL</option>
          <option value="planned">Planned</option>
          <option value="done">Done</option>
          <option value="overdue">Overdue</option>
        </select>
      </div>

      <!-- Technician (hidden for now; Î¸Î± Ï„Î¿ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ„Î¿ STEP B) -->
      <div class="field field-hidden" id="fieldTechnician">
        <label for="reportTechnician">Technician</label>
        <input id="reportTechnician" type="text" placeholder="Ï€.Ï‡. Giorgos" />
      </div>

    </div>

    <!-- Preview -->
    <div class="reports-preview" id="reportsPreview">
      <div class="preview-title">Preview</div>
      <div class="preview-lines" id="previewLines">Lines: ALL</div>
      <div class="preview-dates" id="previewDates">Period: â€”</div>
      <div class="preview-type" id="previewType">Report: Maintenance Status Report</div>
    </div>

    <!-- Actions -->
    <div class="reports-actions">
      <button class="btn-primary" id="generatePdfBtn">ğŸ“„ Generate PDF</button>
      <button class="btn-secondary" id="resetReportBtn">Reset</button>
    </div>
  </section>
</div>


  </div>
   <!-- ADD ASSET MODAL -->
<div id="addAssetOverlay" class="modal-overlay">
  <div class="modal-box">
    <h3>Add Asset</h3>

    <select id="assetLine">
      <option value="">Select Line</option>
      <option>L1</option><option>L2</option><option>L3</option>
      <option>L4</option><option>L5</option><option>L6</option><option>L7</option>
    </select>

    <select id="assetMachine">
      <option value="">Select Machine</option>
      <option>PMC250</option>
      <option>PMC300</option>
      <option>PMC500</option>
      <option>PTC027</option>
    </select>

    <input
      type="text"
      id="assetSn"
      placeholder="Serial Number"
    />

    <div class="modal-actions">
      <button class="btn-table" id="saveAssetBtn">ğŸ’¾ Save</button>
      <button class="btn-cancel" id="cancelAssetBtn">Cancel</button>
    </div>
  </div>
</div>
  
<!-- =====================
     TASK VIEW MODAL
===================== -->
  
<div id="taskViewOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-box modal-wide">

    <h3>Task Details</h3>

    <div id="taskViewContent" class="task-view-grid"></div>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeTaskView()">Close</button>
    </div>

  </div>
</div>

  <!-- JS -->
  <script src="app.js" defer></script>

</body>
</html>

